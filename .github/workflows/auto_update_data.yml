name: 自动数据更新

on:
  schedule:
    # 每天下午5点10分运行（UTC时区是早上9点10分）
    - cron: '10 9 * * *'
  # 你也可以手动触发运行，方便测试
  workflow_dispatch:

jobs:
  update-and-commit-data:
    runs-on: ubuntu-latest
    
    steps:
      - name: 检出仓库代码
        uses: actions/checkout@v2
      
      - name: 设置Python环境
        uses: actions/setup-python@v2
        with:
          python-version: '3.8'

      - name: 安装依赖库
        run: |
          python -m pip install --upgrade pip
          pip install pandas_datareader requests pandas yfinance openpyxl
          
      - name: 运行你的Python脚本
        run: |
          python 个股估值数仓.py

      - name: 提交并推送文件
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add .
          git commit -m "每日数据更新" -a || echo "没有文件变动，跳过提交"
          git push
